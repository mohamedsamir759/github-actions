name: Kubernetes Deployment
on:
  pull_request:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Setup Kubeconfig
      run: |
        mkdir ${HOME}/.kube
        echo "${{ secrets.KUBECONFIG }}" | base64 --decode > kubeconfig
        cat ${HOME}/.kube/config
        
    - name: Apply Kubernetes configurations
      run: |
        export KUBECONFIG=kubeconfig
        kubectl apply -n k8s -f github-actions/
